<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sign Up — Blood Bond</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body style="background:var(--bg)">
    <div class="auth-container">
      <div style="display:flex;align-items:center;gap:3rem;max-width:1200px;width:100%">
        <!-- Left side - Hero image and text -->
        <div class="hero-copy" style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem">
          <img src="Untitled design (4).png" alt="Blood drops" style="width:100%;max-width:400px;margin-bottom:2rem;object-fit:contain" />
          <h2 class="hero-title" style="text-align:center"><span class="brand-name">Blood Bond:</span> Connect. Donate. Save Lives.</h2>
        </div>

        <!-- Right side - Sign up form -->
        <div class="auth-form-wrapper" style="flex:1">
          <div class="auth-header">
            <h1 class="brand" style="justify-content:center">Blood Bond</h1><br>
            <div class="auth-toggle">
              <button type="button" onclick="window.location.href='login.html'">Log In</button>
              <button type="button" class="active">Sign Up</button>
            </div>
          </div>

          <form id="signup-form">
            <input id="name" name="name" type="text" placeholder="Full Name" required />
            <input id="email" name="email" type="email" placeholder="Email Address" required />
            <input id="password" name="password" type="password" placeholder="Password" required />
            
            <select id="blood_group" name="blood_group" required>
              <option value="">Blood Group</option>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>

            <input id="address" name="address" type="text" placeholder="Location" />
            
            <input type="hidden" id="role" name="role" value="donor" />
            <input type="hidden" id="phone" name="phone" value="" />
            <input type="hidden" id="gender" name="gender" value="" />
            <input type="hidden" id="nid" name="nid" value="" />
            <input type="hidden" id="rh" name="rh" value="" />

            <button type="submit" class="btn-blood" style="width:100%;margin-top:1rem">Create Account</button>
          </form>

          <div class="auth-link">
            Already have an account? <a href="login.html">Log In</a>
          </div>

          <div id="signup-result" class="result" aria-live="polite"></div>
        </div>
      </div>
    </div>

    <script src="auth.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', ()=>{
        const form = document.getElementById('signup-form');
        const result = document.getElementById('signup-result');

        form.addEventListener('submit', e=>{
          e.preventDefault();
          const data = {
            id: Date.now(),
            role: form.role.value || 'donor',
            name: form.name.value.trim(),
            gender: form.gender.value || '',
            address: form.address.value.trim(),
            phone: form.phone.value.trim() || form.email.value.trim(),
            email: form.email.value.trim(),
            nid: form.nid.value.trim() || '',
            blood_group: form.blood_group.value,
            rh: form.rh.value || '',
            password: form.password.value
          };

          if(!data.name || !data.email || !data.password){
            result.textContent = 'Please fill required fields: name, email, password.';
            result.style.color = '#ef4444';
            return;
          }

          // Check for existing identifier collision
          const existing = BBAuth.findUserByIdentifier(data.email);
          if(existing){ 
            result.textContent = 'An account with this email already exists.'; 
            result.style.color = '#ef4444';
            return; 
          }

          BBAuth.saveUser(data);
          // create session and redirect to home
          BBAuth.saveSession({role:data.role, identifier:data.email, userId:data.id, loggedAt:Date.now()});
          result.style.color = '#4ade80';
          result.textContent = 'Account created — redirecting to home...';
          setTimeout(()=> window.location.href = 'index.html', 700);
        });
      });
    </script>
  </body>
</html>
